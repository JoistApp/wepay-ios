<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>WePay iOS SDK: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">WePay iOS SDK
   &#160;<span id="projectnumber">7.0.0-prerelease-1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Getting Started </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<object type="image/svg+xml" data="https://go.wepay.com/frontend/images/wepay-logo.svg" alt="WePay logo" title="WePay"></object>
</div>
<h2>Introduction</h2>
<p>The <a class="el" href="interface_we_pay.html">WePay</a> iOS SDK enables collection of payments via various payment methods.</p>
<p>It is meant for consumption by <a href="http://www.wepay.com">WePay</a> partners who are developing their own iOS apps aimed at merchants and/or consumers.</p>
<p>Regardless of the payment method used, the SDK will ultimately return a Payment Token, which must be redeemed via a server-to-server <a href="http://www.wepay.com/developer">API</a> call to complete the transaction.</p>
<h2>Payment methods</h2>
<p>There are two types of payment methods:</p><ul>
<li>Consumer payment methods - to be used in apps where consumers directly pay and/or make donations</li>
<li>Merchant payment methods - to be used in apps where merchants collect payments from their customers</li>
</ul>
<p>The <a class="el" href="interface_we_pay.html">WePay</a> iOS SDK supports the following payment methods</p><ul>
<li>Card Reader: Using an EMV Card Reader, a merchant can accept in-person payments by prosessing a consumer's EMV-enabled chip card. Traditional magnetic stripe cards can be processed as well.</li>
<li>Manual Entry (Consumer/Merchant): The Manual Entry payment method lets consumer and merchant apps accept payments by allowing the user to manually enter card info.</li>
</ul>
<h2>Installation</h2>
<h4>Using <a href="https://cocoapods.org/">cocoapods</a> (recommended)</h4>
<ul>
<li>Add <code>pod "WePay"</code> to your podfile</li>
<li>Run <code>pod install</code></li>
<li>Done!</li>
</ul>
<p>The <a href="https://github.com/wepay/wepay-ios/tree/master/SwiftExample">SwiftExample app</a> also utilizes <code>cocoapods</code>.</p>
<h4>Using library binaries</h4>
<ul>
<li>Download the latest zip file from our <a href="https://github.com/wepay/wepay-ios/releases/latest">releases page</a></li>
<li>Unzip the file and copy the contents anywhere inside your project directory</li>
<li>In Xcode, go to your app's target settings. On the <code>Build Phases</code> tab, expand the <code>Link Binary With Libraries</code> section.</li>
<li>Include the following iOS frameworks:<ul>
<li>AudioToolbox.framework</li>
<li>AVFoundation.framework</li>
<li>CoreBluetooth.framework</li>
<li>CoreLocation.framework</li>
<li>CoreTelephony.framework</li>
<li>ExternalAccessory.framework</li>
<li>MediaPlayer.framework</li>
<li>SystemConfiguration.framework</li>
<li>UIKit.framework</li>
<li>libstdc++.6.0.9.dylib</li>
<li>libstdc++.dylib</li>
<li>libz.dylib</li>
</ul>
</li>
<li>Also include the framework files you copied:<ul>
<li>WePay.framework</li>
</ul>
</li>
<li>Done!</li>
</ul>
<p>Note: Card reader functionality is not available in this SDK by default. If you are interested in using the <a class="el" href="interface_we_pay.html">WePay</a> Card Reader, please contact your sales representative or account manager. If you have yet to be in direct contact with <a class="el" href="interface_we_pay.html">WePay</a>, please email <a href="#" onclick="location.href='mai'+'lto:'+'sal'+'es'+'@we'+'pa'+'y.c'+'om'; return false;">sales<span style="display: none;">.nosp@m.</span>@wep<span style="display: none;">.nosp@m.</span>ay.co<span style="display: none;">.nosp@m.</span>m</a>.</p>
<h2>Documentation</h2>
<p>HTML documentation is hosted on our <a href="http://wepay.github.io/wepay-ios/">Github Pages Site</a>.</p>
<p>Pdf documentation is available on the <a href="https://github.com/wepay/wepay-ios/releases/latest">releases page</a> or as a direct <a href="https://github.com/wepay/wepay-ios/raw/master/documentation/wepay-ios.pdf">download</a>.</p>
<p>General documentation about the <a class="el" href="interface_we_pay.html">WePay</a> mobile point of sale (mPOS) program is available <a href="https://developer.wepay.com/mobile/mpos-program-overview">here</a>. </p><h2>SDK Organization</h2>
<h3><a class="el" href="_we_pay_8h_source.html">WePay.h</a></h3>
<p><code><a class="el" href="_we_pay_8h_source.html">WePay.h</a></code> is the starting point for consuming the SDK, and contains the primary class you will interact with. It exposes all the methods you can call to accept payments via the supported payment methods. Detailed reference documentation is available on the reference page for the <code><a class="el" href="interface_we_pay.html">WePay</a></code> class.</p>
<h3>Delegate protocols</h3>
<p>The SDK uses delegate protocols to respond to API calls. You must adopt the relevant protocols to receive responses to the API calls you make. Detailed reference documentation is available on the reference page for each protocol:</p><ul>
<li><code><a class="el" href="protocol_w_p_authorization_delegate-p.html">WPAuthorizationDelegate</a></code></li>
<li><code><a class="el" href="protocol_w_p_battery_level_delegate-p.html">WPBatteryLevelDelegate</a></code></li>
<li><code><a class="el" href="protocol_w_p_card_reader_delegate-p.html">WPCardReaderDelegate</a></code></li>
<li><code><a class="el" href="protocol_w_p_checkout_delegate-p.html">WPCheckoutDelegate</a></code></li>
<li><code><a class="el" href="protocol_w_p_tokenization_delegate-p.html">WPTokenizationDelegate</a></code></li>
</ul>
<h3>Data Models</h3>
<p>All other classes in the SDK are data models that are used to exchange data between your app and the SDK. Detailed reference documentation is available on the reference page for each class.</p>
<h2>Next Steps</h2>
<p>Head over to the <a href="http://wepay.github.io/wepay-ios/">documentation</a> to see all the API methods available. When you are ready, look at the samples below to learn how to interact with the SDK.</p>
<h2>Error Handling</h2>
<p><code><a class="el" href="_w_p_error_8h.html" title="WPError.h serves as documentation for all errors surfaced by the WePay iOS SDK. ">WPError.h</a></code> serves as documentation for all errors surfaced by the <a class="el" href="interface_we_pay.html">WePay</a> iOS SDK.</p>
<h2>Samples</h2>
<p>See the <a href="https://github.com/wepay/wepay-ios/tree/master/WePayExample">WePayExample app</a> for a working implementation of all API methods.</p>
<p>See the <a href="https://github.com/wepay/wepay-ios/tree/master/SwiftExample">SwiftExample app</a> for a working implementation of all API methods in a Swift 3 application. Note: make sure to open the project using <code>SwiftApp.xcworkspace</code> and not <code>SwiftApp.xcodeproj</code>.</p>
<h3>Initializing a Bridging Header (for Swift apps)</h3>
<ul>
<li>For using Objective-C modules in a Swift application, you will need to create a bridging header.</li>
<li>Make sure you are working in <code>{app_name}.xcworkspace</code> file.</li>
<li>Under your target application folder, create a header file: <code>{app_name}-Bridging-Header.h</code></li>
<li>In the Header file, import the modules you need: <div class="fragment"><div class="line"><span class="preprocessor">#import &lt;WePay/WePay.h&gt;</span></div></div><!-- fragment --></li>
<li>Click on the main application project to get to <code>Build Settings</code>.</li>
<li>Search for <code>bridging header</code> in your target application to find a setting called <code>Swift Compiler - Code Generation</code>.</li>
<li>Double click in the column next to <code>Objective-C Bridging Header</code> and add your Header file: <code>{app_name}/{app_name}-Bridging-Header.h</code></li>
<li>There's no need to import the module in your code; you can use the module by calling it directly in your Swift application.</li>
</ul>
<h3>Initializing the SDK</h3>
<ul>
<li>Complete the installation steps (above).</li>
<li>Include <a class="el" href="_we_pay_8h_source.html">WePay.h</a> <div class="fragment"><div class="line"><span class="preprocessor">#import &lt;WePay/WePay.h&gt;</span></div></div><!-- fragment --></li>
<li>Define a property to store the <a class="el" href="interface_we_pay.html">WePay</a> object <div class="fragment"><div class="line">\<span class="keyword">@property</span> (nonatomic, strong) <a class="code" href="interface_we_pay.html">WePay</a> *wepay;</div></div><!-- fragment --></li>
<li>Create a <a class="el" href="interface_w_p_config.html">WPConfig</a> object <div class="fragment"><div class="line"><a class="code" href="interface_w_p_config.html">WPConfig</a> *config = [[<a class="code" href="interface_w_p_config.html">WPConfig</a> alloc] initWithClientId:@&quot;your_client_id&quot; environment:kWPEnvironmentStage];</div></div><!-- fragment --></li>
<li>Initialize the <a class="el" href="interface_we_pay.html">WePay</a> object and assign it to the property <div class="fragment"><div class="line"><span class="keyword">self</span>.wepay = [[<a class="code" href="interface_we_pay.html">WePay</a> alloc] initWithConfig:config];</div></div><!-- fragment --></li>
</ul>
<h5>Providing permission to use microphone for card reader communication</h5>
<ul>
<li>Open your app's Info.plist file and add an entry for NSMicrophoneUsageDescription. <div class="fragment"><div class="line">&lt;<span class="keywordtype">key</span>&gt;<span class="keyword">NSMicrophoneUsageDescription</span>&lt;/<span class="keywordtype">key</span>&gt;</div><div class="line">&lt;<span class="keywordtype">string</span>&gt;<span class="keyword">Microphone</span> <span class="keyword">permission</span> <span class="keyword">is</span> <span class="keyword">required</span> <span class="keyword">for</span> <span class="keyword">operating</span> <span class="keyword">card</span> <span class="keyword">reader</span>&lt;/<span class="keywordtype">string</span>&gt;</div></div><!-- fragment --></li>
</ul>
<h5>(optional) Providing permission to use location services for fraud detection</h5>
<ul>
<li>In Xcode, go to your projects settings. On the Build Phases tab, expand the Link Binary With Libraries section and include the CoreLocation.framework iOS framework.</li>
<li>Open your app's Info.plist file and add entries for NSLocationUsageDescription and NSLocationWhenInUseUsageDescription. <div class="fragment"><div class="line">&lt;<span class="keywordtype">key</span>&gt;<span class="keyword">NSLocationUsageDescription</span>&lt;/<span class="keywordtype">key</span>&gt;</div><div class="line">&lt;<span class="keywordtype">string</span>&gt;<span class="keyword">Location</span> <span class="keyword">information</span> <span class="keyword">is</span> <span class="keyword">used</span> <span class="keyword">for</span> <span class="keyword">fraud</span> <span class="keyword">prevention</span>&lt;/<span class="keywordtype">string</span>&gt;</div><div class="line">&lt;<span class="keywordtype">key</span>&gt;<span class="keyword">NSLocationWhenInUseUsageDescription</span>&lt;/<span class="keywordtype">key</span>&gt;</div><div class="line">&lt;<span class="keywordtype">string</span>&gt;<span class="keyword">Location</span> <span class="keyword">information</span> <span class="keyword">is</span> <span class="keyword">used</span> <span class="keyword">for</span> <span class="keyword">fraud</span> <span class="keyword">prevention</span>&lt;/<span class="keywordtype">string</span>&gt;</div></div><!-- fragment --></li>
<li>Set the option on the config object, before initializing the <a class="el" href="interface_we_pay.html">WePay</a> object <div class="fragment"><div class="line">config.<a class="code" href="interface_w_p_config.html#a9ce0453ede6ac55095f7a8a30700b7ae">useLocation</a> = YES;</div></div><!-- fragment --></li>
</ul>
<h3>Integrating the Card Reader payment methods (Swipe+Dip)</h3>
<ul>
<li>Adopt the <a class="el" href="protocol_w_p_card_reader_delegate-p.html">WPCardReaderDelegate</a>, <a class="el" href="protocol_w_p_tokenization_delegate-p.html">WPTokenizationDelegate</a>, and <a class="el" href="protocol_w_p_authorization_delegate-p.html">WPAuthorizationDelegate</a> protocols <div class="fragment"><div class="line">\<span class="keyword">@interface </span>MyWePayDelegate : NSObject &lt;<a class="code" href="protocol_w_p_card_reader_delegate-p.html">WPCardReaderDelegate</a>, <a class="code" href="protocol_w_p_tokenization_delegate-p.html">WPTokenizationDelegate</a>, <a class="code" href="protocol_w_p_authorization_delegate-p.html">WPAuthorizationDelegate</a>&gt;</div></div><!-- fragment --></li>
<li>Implement the <a class="el" href="protocol_w_p_card_reader_delegate-p.html">WPCardReaderDelegate</a> protocol methods <div class="fragment"><div class="line">- (void) cardReaderDidChangeStatus:(<span class="keywordtype">id</span>) status</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (status == kWPCardReaderStatusNotConnected) {</div><div class="line">        <span class="comment">// show UI that prompts the user to connect the Card Reader</span></div><div class="line">        <span class="keyword">self</span>.statusLabel.text = <span class="stringliteral">@&quot;Connect Card Reader&quot;</span>;</div><div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status == kWPCardReaderStatusWaitingForSwipe) {</div><div class="line">        <span class="comment">// show UI that prompts the user to swipe</span></div><div class="line">        <span class="keyword">self</span>.statusLabel.text = <span class="stringliteral">@&quot;Swipe Card&quot;</span>;</div><div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status == kWPCardReaderStatusSwipeDetected) {</div><div class="line">        <span class="comment">// provide feedback to the user that a swipe was detected</span></div><div class="line">        <span class="keyword">self</span>.statusLabel.text = <span class="stringliteral">@&quot;Swipe Detected...&quot;</span>;</div><div class="line">    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status == kWPCardReaderStatusTokenizing) {</div><div class="line">        <span class="comment">// provide feedback to the user that the card info is being tokenized/verified</span></div><div class="line">        <span class="keyword">self</span>.statusLabel.text = <span class="stringliteral">@&quot;Tokenizing...&quot;</span>;</div><div class="line">    }  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (status == kWPCardReaderStatusStopped) {</div><div class="line">        <span class="comment">// provide feedback to the user that the swiper has stopped</span></div><div class="line">        <span class="keyword">self</span>.statusLabel.text = <span class="stringliteral">@&quot;Card Reader Stopped&quot;</span>;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        <span class="comment">// handle any other status messages</span></div><div class="line">        <span class="keyword">self</span>.statusLabel.text = [status description];</div><div class="line">    } </div><div class="line">}</div><div class="line"></div><div class="line">- (void) selectCardReader:(NSArray *)cardReaderNames</div><div class="line">               completion:(<span class="keywordtype">void</span> (^)(NSInteger selectedIndex))completion</div><div class="line">{</div><div class="line">    <span class="comment">// In production apps, the merchant must choose the card reader they want to use.</span></div><div class="line">    <span class="comment">// Here, we always select the first card reader in the array</span></div><div class="line">    <span class="keywordtype">int</span> selectedIndex = 0;</div><div class="line">    completion(selectedIndex);</div><div class="line">}</div><div class="line"></div><div class="line">- (void) shouldResetCardReaderWithCompletion:(<span class="keywordtype">void</span> (^)(BOOL))completion</div><div class="line">{</div><div class="line">    <span class="comment">// Change this to YES if you want to reset the card reader</span></div><div class="line">    completion(NO);</div><div class="line">}</div><div class="line"></div><div class="line">- (void) authorizeAmountWithCompletion:(<span class="keywordtype">void</span> (^)(NSDecimalNumber *amount, NSString *currencyCode, <span class="keywordtype">long</span> accountId))completion</div><div class="line">{</div><div class="line">    <span class="comment">// obtain transaction info</span></div><div class="line">    <span class="keywordtype">double</span> amount = @(10.00);</div><div class="line">    NSString *currencyCode = <span class="stringliteral">@&quot;USD&quot;</span>;</div><div class="line">    <span class="keywordtype">long</span> accountId = 12345678;</div><div class="line"></div><div class="line">    <span class="comment">// execute the completion</span></div><div class="line">    completion(amount, currencyCode, accountId);</div><div class="line">}</div><div class="line"></div><div class="line">- (void) selectEMVApplication:(NSArray *)applications</div><div class="line">                   completion:(<span class="keywordtype">void</span> (^)(NSInteger selectedIndex))completion</div><div class="line">{</div><div class="line">    <span class="comment">// In production apps, the payer must choose the app id they want to use.</span></div><div class="line">    <span class="comment">// Here, we always select the first application in the array</span></div><div class="line">    <span class="keywordtype">int</span> selectedIndex = 0;</div><div class="line">    completion(selectedIndex);</div><div class="line">}</div><div class="line"></div><div class="line">- (void) insertPayerEmailWithCompletion:(<span class="keywordtype">void</span> (^)(NSString *email))completion</div><div class="line">{</div><div class="line">    <span class="comment">// obtain email</span></div><div class="line">    NSString *email = <span class="stringliteral">@&quot;emv@example.com&quot;</span>;</div><div class="line"></div><div class="line">    <span class="comment">// execute the completion</span></div><div class="line">    completion(email);</div><div class="line">}</div><div class="line"></div><div class="line">- (void) didReadPaymentInfo:(<a class="code" href="interface_w_p_payment_info.html">WPPaymentInfo</a> *)paymentInfo </div><div class="line">{</div><div class="line">    <span class="comment">// use the payment info (for display/recordkeeping)</span></div><div class="line">    <span class="comment">// wait for tokenization(swipe)/authorization(dip) response</span></div><div class="line">}</div><div class="line"></div><div class="line">- (void) didFailToReadPaymentInfoWithError:(NSError *)error   </div><div class="line">{</div><div class="line">    <span class="comment">// Handle the error</span></div><div class="line">}</div></div><!-- fragment --></li>
<li>Implement the <a class="el" href="protocol_w_p_tokenization_delegate-p.html">WPTokenizationDelegate</a> protocol methods <div class="fragment"><div class="line">- (void) paymentInfo:(<a class="code" href="interface_w_p_payment_info.html">WPPaymentInfo</a> *)paymentInfo didTokenize:(<a class="code" href="interface_w_p_payment_token.html">WPPaymentToken</a> *)paymentToken</div><div class="line">{</div><div class="line">    <span class="comment">// Send the tokenId (paymentToken.tokenId) to your server</span></div><div class="line">    <span class="comment">// Your server would use the tokenId to make a /checkout/create call to complete the transaction</span></div><div class="line">}</div><div class="line"></div><div class="line">- (void) paymentInfo:(<a class="code" href="interface_w_p_payment_info.html">WPPaymentInfo</a> *)paymentInfo didFailTokenization:(NSError *)error</div><div class="line">{</div><div class="line">    <span class="comment">// Handle the error</span></div><div class="line">}</div></div><!-- fragment --></li>
<li>Implement the <a class="el" href="protocol_w_p_authorization_delegate-p.html">WPAuthorizationDelegate</a> protocol methods <div class="fragment"><div class="line">- (void) paymentInfo:(<a class="code" href="interface_w_p_payment_info.html">WPPaymentInfo</a> *)paymentInfo</div><div class="line">        didAuthorize:(<a class="code" href="interface_w_p_authorization_info.html">WPAuthorizationInfo</a> *)authorizationInfo</div><div class="line">{</div><div class="line">    <span class="comment">// Send the token Id (authorizationInfo.tokenId) and transaction token (authorizationInfo.transactionToken) to your server</span></div><div class="line">    <span class="comment">// Your server must use the tokenId and transactionToken to make a /checkout/create call to complete the transaction</span></div><div class="line">}</div><div class="line"></div><div class="line">- (void) paymentInfo:(<a class="code" href="interface_w_p_payment_info.html">WPPaymentInfo</a> *)paymentInfo</div><div class="line">didFailAuthorization:(NSError *)error</div><div class="line">{</div><div class="line">    <span class="comment">// Handle the error</span></div><div class="line">}</div></div><!-- fragment --></li>
<li>Make the <a class="el" href="interface_we_pay.html">WePay</a> API call, passing in the instance(s) of the class(es) that implemented the delegate protocols <div class="fragment"><div class="line">[<span class="keyword">self</span>.wepay startCardReaderForTokenizingWithCardReaderDelegate:self tokenizationDelegate:self authorizationDelegate:self];</div><div class="line"><span class="comment">// Show UI asking the user to insert the card reader and wait for it to be ready</span></div></div><!-- fragment --></li>
<li>That's it! The following sequence of events will occur:</li>
</ul>
<ol type="1">
<li>The user inserts the card reader (or it is already inserted), or powers on their bluetooth card reader.</li>
<li>The SDK tries to detect the card reader and initialize it.<ul>
<li>The <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusSearching</code>.</li>
<li>If any card readers are discovered, the <code>selectCardReader:</code> method will be called with an array of discovered devices. If anything is plugged into the headphone jack, <code>"AUDIOJACK"</code> will be one of the devices discovered.</li>
<li>If no card readers are detected, the <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusNotConnected</code>.</li>
<li>Once the card reader selection completion block is called, the SDK will attempt to to connect to the selected card reader.</li>
<li>If the card reader is successfully connected, then the <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusConnected</code>.</li>
</ul>
</li>
<li>Next, the SDK checks if the card reader is correctly configured (the <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusCheckingReader</code>).<ul>
<li>If the card reader is already configured, the app is given a chance to force configuration. The SDK calls the <code>shouldResetCardReaderWithCompletion:</code> method, and the app must execute the completion method, telling the SDK whether or not the reader should be reset.</li>
<li>If the reader was not already configured, or the app requested a reset, the <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusConfiguringReader</code> and the card reader is configured.</li>
</ul>
</li>
<li>Next, if the card reader is successfully initialized, the SDK asks the app for transaction information by calling the <code>authorizeAmountWithCompletion:</code> method. The app must execute the completion method, telling the SDK what the amount, currency code and merchant account id is.</li>
<li>Next, the <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusWaitingForCard</code>.</li>
<li>If the user swipes a card successfully:<ul>
<li>The <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusSwipeDetected</code>.</li>
<li>The SDK attempts to ask the app for the payer’s email by calling the <code>insertPayerEmailWithCompletion:</code> method. If the app implements this optional delegate method, it must execute the completion method and pass in the payer’s email address.</li>
<li>The <code>didReadPaymentInfo:</code> method is called with the obtained payment info.</li>
<li>The <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusTokenizing</code>, and the SDK will automatically send the obtained card info to <a class="el" href="interface_we_pay.html">WePay</a>'s servers for tokenization.</li>
<li>If tokenization succeeds, the <code>paymentInfo:didTokenize:</code> method will be called.</li>
<li>If tokenization fails, the <code>paymentInfo:didFailTokenization:</code> method will be called with the appropriate error, and processing will stop.</li>
</ul>
</li>
<li>Instead, if the user dips a card successfully:<ul>
<li>The <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusCardDipped</code></li>
<li>If the card has multiple applications on it, the payer must choose one:<ul>
<li>The SDK calls the <code>selectEMVApplication:completion:</code> method with a list of Applications on the card.</li>
<li>The app must display these Applications to the payer and allow them to choose which application they want to use.</li>
<li>Once the payer has decided, the app must inform the SDK of the choice by executing the completion method and passing in the index of the chosen application.</li>
</ul>
</li>
<li>Next, the SDK obtains card data from the chip on the card.</li>
<li>The SDK attempts to ask the app for the payer’s email by calling the <code>insertPayerEmailWithCompletion:</code> method. If the app implements this optional delegate method, it must execute the completion method and pass in the payer’s email address.</li>
<li>The <code>didReadPaymentInfo:</code> method is called with the obtained payment info.</li>
<li>The <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusAuthorizing</code>, and the SDK will automatically send the obtained EMV card info to <a class="el" href="interface_we_pay.html">WePay</a>'s servers for authorization.</li>
<li>If authorization succeeds, the <code>paymentInfo:didAuthorize:</code> method will be called and processing will stop.</li>
<li>If authorization fails, the <code>paymentInfo:didFailAuthorization:</code> method will be called.</li>
</ul>
</li>
<li>If a recoverable error occurs during swiping or dipping, one of the failure methods will be called. After a few seconds, the <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusWaitingForCard</code> and the card reader will again wait for the user to swipe/dip a card.</li>
<li>If an unrecoverable error occurs, or if the SDK is unable to obtain data from the card, one of teh failure methods will be called with the appropriate error.</li>
<li>When processing stops, the <code>cardReaderDidChangeStatus:</code> method will be called with <code>status = kWPCardReaderStatusStopped</code>.</li>
</ol>
<ol type="1">
<li>Done!</li>
</ol>
<p>Note: After the card is dipped into the reader, it must not be removed until a successful auth response (or an error) is returned.</p>
<h3>Integrating the Manual payment method</h3>
<ul>
<li>Adopt the <a class="el" href="protocol_w_p_tokenization_delegate-p.html">WPTokenizationDelegate</a> protocol <div class="fragment"><div class="line">\<span class="keyword">@interface </span>MyWePayDelegate : NSObject &lt;<a class="code" href="protocol_w_p_tokenization_delegate-p.html">WPTokenizationDelegate</a>&gt;</div></div><!-- fragment --></li>
<li>Implement the <a class="el" href="protocol_w_p_tokenization_delegate-p.html">WPTokenizationDelegate</a> protocol methods <div class="fragment"><div class="line">- (void) paymentInfo:(<a class="code" href="interface_w_p_payment_info.html">WPPaymentInfo</a> *)paymentInfo didTokenize:(<a class="code" href="interface_w_p_payment_token.html">WPPaymentToken</a> *)paymentToken</div><div class="line">{</div><div class="line">    <span class="comment">// Send the tokenId (paymentToken.tokenId) to your server</span></div><div class="line">    <span class="comment">// Your server can use the tokenId to make a /checkout/create call to complete the transaction</span></div><div class="line">}</div><div class="line"></div><div class="line">- (void) paymentInfo:(<a class="code" href="interface_w_p_payment_info.html">WPPaymentInfo</a> *)paymentInfo didFailTokenization:(NSError *)error</div><div class="line">{</div><div class="line">    <span class="comment">// Handle error</span></div><div class="line">}</div></div><!-- fragment --></li>
<li>Instantiate a <a class="el" href="interface_w_p_payment_info.html">WPPaymentInfo</a> object using the user's credit card and address data <div class="fragment"><div class="line"><a class="code" href="interface_w_p_payment_info.html">WPPaymentInfo</a> *paymentInfo = [[<a class="code" href="interface_w_p_payment_info.html">WPPaymentInfo</a> alloc] initWithFirstName:@&quot;WPiOS&quot;</div><div class="line">                                                             lastName:@&quot;Example&quot;</div><div class="line">                                                                email:@&quot;wp.ios.example@wepay.com&quot;</div><div class="line">                                                       billingAddress:[[<a class="code" href="interface_w_p_address.html">WPAddress</a> alloc] initWithZip:@&quot;94306&quot;]</div><div class="line">                                                      shippingAddress:nil</div><div class="line">                                                           cardNumber:@&quot;5496198584584769&quot;</div><div class="line">                                                                  cvv:@&quot;123&quot;</div><div class="line">                                                             expMonth:@&quot;04&quot;</div><div class="line">                                                              expYear:@&quot;2020&quot;</div><div class="line">                                                      virtualTerminal:YES];</div><div class="line"><span class="comment">// Note: the virtualTerminal parameter above should be set to YES if a merchant is collecting payments manually using your app. It should be set to NO if a payer is making a manual payment using your app.</span></div></div><!-- fragment --></li>
<li>Make the <a class="el" href="interface_we_pay.html">WePay</a> API call, passing in the instance of the class that implemented the <a class="el" href="protocol_w_p_tokenization_delegate-p.html">WPTokenizationDelegate</a> protocol <div class="fragment"><div class="line">[<span class="keyword">self</span>.wepay tokenizeManualPaymentInfo:paymentInfo tokenizationDelegate:self];</div></div><!-- fragment --></li>
<li>That's it! The following sequence of events will occur:</li>
</ul>
<ol type="1">
<li>The SDK will send the obtained payment info to <a class="el" href="interface_we_pay.html">WePay</a>'s servers for tokenization</li>
<li>If the tokenization succeeds, the <code>paymentInfo:didTokenize:</code> method will be called</li>
<li>Otherwise, if the tokenization fails, the <code>paymentInfo:didFailTokenization:</code> method will be called with the appropriate error</li>
</ol>
<h3>Integrating the Store Signature API</h3>
<ul>
<li>Adopt the <a class="el" href="protocol_w_p_checkout_delegate-p.html">WPCheckoutDelegate</a> protocol <div class="fragment"><div class="line">\<span class="keyword">@interface </span>MyWePayDelegate : NSObject &lt;<a class="code" href="protocol_w_p_checkout_delegate-p.html">WPCheckoutDelegate</a>&gt;</div></div><!-- fragment --></li>
<li>Implement the <a class="el" href="protocol_w_p_checkout_delegate-p.html">WPCheckoutDelegate</a> protocol methods <div class="fragment"><div class="line">- (void) didStoreSignature:(NSString *)signatureUrl</div><div class="line">             forCheckoutId:(NSString *)checkoutId</div><div class="line">{</div><div class="line">    <span class="comment">// success! nothing to do here</span></div><div class="line">}</div><div class="line"></div><div class="line">- (void) didFailToStoreSignatureImage:(UIImage *)image</div><div class="line">                        forCheckoutId:(NSString *)checkoutId</div><div class="line">                            withError:(NSError *)error</div><div class="line">{</div><div class="line">    <span class="comment">// handle the error</span></div><div class="line">}</div></div><!-- fragment --></li>
<li>Obtain the checkout_id associated with this signature from your server <div class="fragment"><div class="line">NSString *checkoutId = [<span class="keyword">self</span> obtainCheckoutId];</div></div><!-- fragment --></li>
<li>Instantiate a UIImage containing the user's signature <div class="fragment"><div class="line">UIImage *signature = [UIImage imageNamed:@&quot;dd_signature.png&quot;];</div></div><!-- fragment --></li>
<li>Make the <a class="el" href="interface_we_pay.html">WePay</a> API call, passing in the instance of the class that implemented the <a class="el" href="protocol_w_p_checkout_delegate-p.html">WPCheckoutDelegate</a> protocol <div class="fragment"><div class="line">[<span class="keyword">self</span>.wepay storeSignatureImage:signature </div><div class="line">                  forCheckoutId:checkoutId</div><div class="line">               checkoutDelegate:self];</div></div><!-- fragment --></li>
<li>That's it! The following sequence of events will occur:<ol type="1">
<li>The SDK will send the obtained signature to <a class="el" href="interface_we_pay.html">WePay</a>'s servers</li>
<li>If the operation succeeds, the <code>didStoreSignature:forCheckoutId:</code> method will be called</li>
<li>Otherwise, if the operation fails, the <code>didFailToStoreSignatureImage:forCheckoutId:withError:</code> method will be called with the appropriate error</li>
</ol>
</li>
</ul>
<h3>Integrating the the Battery Level API</h3>
<ul>
<li>Adopt the <a class="el" href="protocol_w_p_battery_level_delegate-p.html">WPBatteryLevelDelegate</a> protocol <div class="fragment"><div class="line">\<span class="keyword">@interface </span>MyWePayDelegate : NSObject &lt;<a class="code" href="protocol_w_p_battery_level_delegate-p.html">WPBatteryLevelDelegate</a>&gt;</div></div><!-- fragment --></li>
<li>Implement the <a class="el" href="protocol_w_p_checkout_delegate-p.html">WPCheckoutDelegate</a> protocol methods <div class="fragment"><div class="line">- (void) didGetBatteryLevel:(<span class="keywordtype">int</span>)batteryLevel</div><div class="line">{</div><div class="line">    <span class="comment">// success! Show the current level to the user.</span></div><div class="line">}</div><div class="line"></div><div class="line">- (void) didFailToGetBatteryLevelwithError:(NSError *)error</div><div class="line">{</div><div class="line">    <span class="comment">// handle the error</span></div><div class="line">}</div></div><!-- fragment --></li>
<li>Make the <a class="el" href="interface_we_pay.html">WePay</a> API call, passing in the instance(s) of the class(es) that implemented the <a class="el" href="protocol_w_p_card_reader_delegate-p.html">WPCardReaderDelegate</a> and <a class="el" href="protocol_w_p_battery_level_delegate-p.html">WPBatteryLevelDelegate</a> protocols <div class="fragment"><div class="line">[<span class="keyword">self</span>.wepay getCardReaderBatteryLevelWithCardReaderDelegate:self batteryLevelDelegate:self];</div></div><!-- fragment --></li>
<li>That's it! The following sequence of events will occur:</li>
</ul>
<ol type="1">
<li>The SDK will attempt to read the battery level of the card reader</li>
<li>If the operation succeeds, <a class="el" href="protocol_w_p_battery_level_delegate-p.html">WPBatteryLevelDelegate</a>'s <code>didGetBatteryLevel:</code> method will be called with the result</li>
<li>Otherwise, if the operation fails, <a class="el" href="protocol_w_p_battery_level_delegate-p.html">WPBatteryLevelDelegate</a>'s <code>didFailToGetBatteryLevelwithError:</code> method will be called with the appropriate error</li>
</ol>
<h3>Configuring the SDK</h3>
<p>The experiences described above can be modified by utilizing the configuration options available on the <a class="el" href="interface_w_p_config.html">WPConfig</a> object. Detailed descriptions for each configurable property is available in the documentation for <a class="el" href="interface_w_p_config.html">WPConfig</a>.</p>
<h3>Test/develop using mock card reader and mock WepayClient</h3>
<ul>
<li>To use mock card reader implementation instead of using the real reader, instantiate a MockConfig object and pass it to Config: <div class="fragment"><div class="line"><a class="code" href="interface_w_p_mock_config.html">WPMockConfig</a> *mockConfig = [[<a class="code" href="interface_w_p_mock_config.html">WPMockConfig</a> alloc] init];</div><div class="line">config.mockConfig = mockConfig;</div></div><!-- fragment --></li>
<li>To use mock WepayClient implementation instead of interacting with the real <a class="el" href="interface_we_pay.html">WePay</a> server, set the corresponding option on the mockConfig object: <div class="fragment"><div class="line">mockConfig.<a class="code" href="interface_w_p_mock_config.html#a48b713718b8e67e73f61437a58d4dd7e">useMockWepayClient</a> = YES;</div></div><!-- fragment --></li>
<li>Other options are also available: <div class="fragment"><div class="line">mockConfig.<a class="code" href="interface_w_p_mock_config.html#a66ef6af3f1311751312343612900ed7c">mockPaymentMethod</a> = kWPPaymentMethodSwipe; <span class="comment">// Payment method to mock; Defaults to SWIPE.</span></div><div class="line">mockConfig.<a class="code" href="interface_w_p_mock_config.html#a57df6a16910ab10ea83fcb013e9c0267">cardReadTimeOut</a> = YES; <span class="comment">// To mock a card reader timeout; Defaults to NO.</span></div><div class="line">mockConfig.<a class="code" href="interface_w_p_mock_config.html#a9f4551171d4d285347b6d0ca0acb28c1">cardReadFailure</a> = YES; <span class="comment">// To mock a failure for card reading; Defaults to NO.</span></div><div class="line">mockConfig.<a class="code" href="interface_w_p_mock_config.html#a73c606dfacfa6051f0833a543663a037">cardTokenizationFailure</a> = YES; <span class="comment">// To mock a failure for card tokenization; Defaults to NO.</span></div><div class="line">mockConfig.<a class="code" href="interface_w_p_mock_config.html#a9626a92bba74cacb52ac709d97aac40e">EMVAuthFailure</a> = YES; <span class="comment">// To mock a failure for EMV authorization; Defaults to NO.</span></div><div class="line">mockConfig.<a class="code" href="interface_w_p_mock_config.html#a58e50db616b2e982cff5730475e9ed25">multipleEMVApplication</a> = YES; <span class="comment">// To mock multiple EMV applications on card to choose from; Defaults to NO.</span></div><div class="line">mockConfig.<a class="code" href="interface_w_p_mock_config.html#a3112bdc4f585e452194df22a1c5ad48a">batteryLevelError</a> = YES; <span class="comment">// To mock an error while fetching battery level; Defaults to NO.</span></div><div class="line">mockConfig.<a class="code" href="interface_w_p_mock_config.html#aae16dd40092a49eecad1dd7efac036ca">mockCardReaderIsDetected</a> = NO; <span class="comment">// To mock a card reader being available for connection; Defaults to YES.</span></div></div><!-- fragment --></li>
</ul>
<h3>Integration tests and unit tests</h3>
<p>All the integration tests and unit tests are located in the <code>/WePayTests/</code> directory.</p>
<h5>From Xcode</h5>
<p>From the Tests Navigator tab:</p>
<ul>
<li>To run a single test, right-click the test method and select "Test &lt;name&gt;".</li>
<li>To run all test methods in a class, right-click the class and select "Run &lt;name&gt;".</li>
<li>To run all tests in a directory, right-click the directory and select "Run &lt;name&gt;".</li>
<li>To run all tests in the project, use the menu option Product &gt; Test or press (Cmd + U).</li>
</ul>
<h5>From the command line</h5>
<p>Go to this repo directory and execute: </p><div class="fragment"><div class="line">xcodebuild test -project WePay.xcodeproj -scheme &quot;Release Framework&quot;  -destination &#39;platform=iOS Simulator,name=iPhone 7&#39;</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Apr 18 2017 15:20:34 for WePay iOS SDK by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
